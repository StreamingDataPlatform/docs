<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="Dell EMC Streaming Data Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="Dell EMC Streaming Data Platform Blog Atom Feed"><title data-react-helmet="true">Watermarking | Dell EMC Streaming Data Platform</title><meta data-react-helmet="true" property="og:url" content="https://StreamingDataPlatform.github.io//docs/docs/pravega/watermarking"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Watermarking | Dell EMC Streaming Data Platform"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="shortcut icon" href="/docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://StreamingDataPlatform.github.io//docs/docs/pravega/watermarking"><link data-react-helmet="true" rel="alternate" href="https://StreamingDataPlatform.github.io//docs/docs/pravega/watermarking" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://StreamingDataPlatform.github.io//docs/docs/pravega/watermarking" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.77b8a9b9.css">
<link rel="preload" href="/docs/assets/js/styles.b1fb6875.js" as="script">
<link rel="preload" href="/docs/assets/js/runtime~main.6fd86e16.js" as="script">
<link rel="preload" href="/docs/assets/js/main.136b01c8.js" as="script">
<link rel="preload" href="/docs/assets/js/1.3bcfe3f0.js" as="script">
<link rel="preload" href="/docs/assets/js/2.9f9d1907.js" as="script">
<link rel="preload" href="/docs/assets/js/83.e85de545.js" as="script">
<link rel="preload" href="/docs/assets/js/84.8b65af75.js" as="script">
<link rel="preload" href="/docs/assets/js/935f2afb.d24e4f9c.js" as="script">
<link rel="preload" href="/docs/assets/js/17896441.654df565.js" as="script">
<link rel="preload" href="/docs/assets/js/b253db87.77b98aad.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.dell.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/docs/sdp/overview">Docs</a><a class="navbar__item navbar__link" href="/docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://www.dell.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/docs/sdp/overview">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Streaming Data Platform</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/about">About</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Installation and Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/install/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/install/guide">Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/troubleshooting/index">Overview</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Developer&#x27;s Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/developer-guide/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/developer-guide/guide">Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Analytics</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Flink</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/analytics/flink/index">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Spark</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/analytics/spark/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/analytics/spark/deploying">Deploying</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/analytics/spark/troubleshooting">Troubleshooting</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Security Configuration Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/security-configuration/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/sdp/security-configuration/guide">Guide</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/index">Pravega Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Understanding Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/pravega-concepts">Pravega Concepts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/terminology">Terminology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/key-features">Pravega Key Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/faq">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/segment-store-service">Pravega Segment Store Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/segment-containers">Segment Containers in a Pravega Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/controller-service">Pravega Controller Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/wire-protocol">Pravega Streaming Service Wire Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/state-synchronizer-design">State Synchronizer Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/pravega/reader-group-design">Reader Groups Design</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/docs/pravega/watermarking">Watermarking</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Developing Pravega Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/pravega-write-read-methods">Methods for Writing and Reading Pravega Streams</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/javadoc">Java API Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/rest/restapis">Pravega Controller APIs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/connectors">Pravega Connectors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/basic-reader-and-writer">Basic Reader and Writer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/state-synchronizer">State Synchronizer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/transactions">Transactions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/streamcuts">StreamCuts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Running Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/deployment/deployment">Pravega Deployment Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/deployment/manual-install">Manual Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/deployment/kubernetes-install">Deploying in Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/deployment/docker-swarm">Deploying in a Docker Swarm</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/deployment/dcos-install">Deploying on DC/OS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/deployment/aws-install">Running on AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/metrics">Pravega Metrics</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Pravega Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/auth/auth-plugin">Implementation of Pravega Authentication/Authorization Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/auth/client-auth">Client Auth Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/security/pravega-security-authorization-authentication">TLS, Authorization, Authentication - Enabling encryption, authorization and authentication features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/security/pravega-security-configurations">Pravega Security Configurations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/security/pravega-security-encryption">Pravega Encryption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/security/securing-distributed-mode-cluster">Setting Up Security for a Distributed Mode Cluster</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Contributing to Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/contributing">Contributing to Pravega</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/roadmap">Pravega Roadmap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/pravega/join-community">Join the Pravega Community</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Connectors</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Flink</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/quickstart">Quick Start</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/streaming">Streaming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/batch">Batch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/table-api">Table API</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/configurations">Configurations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/flink-connectors/serialization">Serialization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Spark</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/spark-connectors/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/spark-connectors/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/spark-connectors/samples">Samples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/spark-connectors/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/spark-connectors/build-connector">Building the Connector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/spark-connectors/limitations">Limitations</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/pravega/nifi-pravega" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">NiFi</a></li><li class="menu__list-item"><a href="https://github.com/pravega?q=logstash" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Logstash</a></li><li class="menu__list-item"><a href="https://github.com/pravega/boomi-connector" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Boomi</a></li><li class="menu__list-item"><a href="https://github.com/pravega/kafka-adapter" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Kafka Adapter</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Watermarking</h1></header><div class="markdown"><p>Stream-processing applications may require a time-bounded set of metrics to make a calculation, make a decision, or
commit a transaction. Pravega watermarking provides a way for applications to define time and know with some certainty
that it has a complete set of data up to a watermark. All events earlier than a watermark can be processed, acted upon,
or committed.</p><p>In Pravega stream processing, data ingress is typically handled by multiple Pravega Writers, and data processing is
typically handled by multiple Pravega Readers. In a parallel processing scenario, events can ingress out of order (even
though final order is guaranteed). Out of order ingress and the possibility of delayed Writers make it difficult for
a Reader application to know when a complete set of events exists for any given time window. How long should a Reader
wait before deciding that it has all of the events for a defined time window?  Watermarking satisfies that question.</p><p>In general, watermarking works like this:</p><ul><li>The concept of time is defined by the application.</li><li>Pravega Writers report their time and positions in the stream (or use a feature that automatically timestamps events).  </li><li>The Pravega controller periodically consolidates the reports into watermarks. The watermark defines both time and a
stream position.</li><li>Pravega Readers request time windows and use them to navigate the stream. The lower bound of a returned time window is
the current watermark.</li><li>The application can process data with some certainty that the data is complete up to the watermarked time and position.       </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="concepts-related-to-watermarking"></a>Concepts related to watermarking<a class="hash-link" href="#concepts-related-to-watermarking" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-watermark"></a>The watermark<a class="hash-link" href="#the-watermark" title="Direct link to heading">#</a></h3><p>The controller produces data structures called watermarks. A watermark has three values:</p><ul><li><code>lowerTimeBound</code> -  a lower bound time corresponding to the streamcut.  A watermark makes a weak claim that all events in
the stream after the <code>watermark.streamcut</code> have time greater than <code>watermark.lowerbound</code>.</li><li><code>upperTimeBound</code> -  an upper bound time corresponding to the streamcut. A watermark makes a weak suggestion that all
events it saw up to <code>watermark.streamcut</code> have an upper bound time of watermark.upperBound.</li><li><code>streamcut(position)</code> - an upper bound on positions from all writers with respect to the lower bound time.</li></ul><p>A streamcut is a logical partition of a stream. It corresponds to a <code>segment to offset</code> mapping in the stream. Since a
stream is partitioned into multiple segments, a stream cut divides the stream such that you can perform bounded
processing before or after that stream cut. Since stream cut spans multiple segments, offsets in each segment correspond
to individual events written within those segments.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="time-window"></a>Time window<a class="hash-link" href="#time-window" title="Direct link to heading">#</a></h3><p>A Reader requests a time window. A Time window contains two watermarks.</p><ul><li><code>lowerTimeBound</code></li><li><code>upperTimeBound</code></li></ul><p>In the following example, the two watermarks are W1 and W2.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">TimeWindow T1 = {W1.lowerbound, W2.upperbound}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Pravega makes a weak claim that all events between <code>W1.streamCut</code> and <code>W2.streamCut</code> have times that fall in the
timewindow <code>T1</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="time"></a>Time<a class="hash-link" href="#time" title="Direct link to heading">#</a></h3><p>The concept of time is defined by the application. The Pravega APIs provide the means for Writers to note the time and
for Readers to request the watermarked window of time, but the definition of time itself is controlled by the
application.</p><p>The time may indicate the time the data was written to the stream (ingestion time). Time may alternatively be equated
to event time (the time the event occurred).  Time can denote wall clock time, some other traditional time, or an
arbitrary value, like a file number that advances as the application ingests file data.</p><p>Time has two requirements:</p><ul><li>Time is a variable of type <code>long</code>.  </li><li>Time must increase monotonically. That is, if time is 6, then a time of 5 is earlier, and a time of 7
is later.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-pravega-writers-report-time"></a>How Pravega Writers report time<a class="hash-link" href="#how-pravega-writers-report-time" title="Direct link to heading">#</a></h2><p>A Writer reports time corresponding to a position. A position identifies the location within a stream where the Writer
last wrote something.</p><p>There are three ways for Pravega Writers to report time.</p><ul><li>Explicitly note the time  </li><li>Note time on transaction commit</li><li>Automatically note wall clock time</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="explicitly-note-time"></a>Explicitly note time<a class="hash-link" href="#explicitly-note-time" title="Direct link to heading">#</a></h3><p>The following API method notes time. The position is captured with time.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">writer.noteTime(long timestamp);  </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>A Writer can note time after every event write, after writing <code>n</code> number of events, or use it periodically to indicate
the time and position.</p><p>Here is example usage:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">EventStreamWriter&lt;EventType&gt; writer = clientFactory.createEventWriter(stream, serializer,EventWriterConfig.builder().build());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //... write events ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">writer.noteTime(currentTime);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="note-time-on-transaction-commit"></a>Note time on transaction commit<a class="hash-link" href="#note-time-on-transaction-commit" title="Direct link to heading">#</a></h3><p>For transactional writes, the commit call can supply the timestamp. The following Writer method passes the time to the
Controller as part of the commit.</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">void commit(long timestamp) throws TxnFailedException;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Transaction&lt;EventType&gt; txn = writer.beginTxn();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        //... write events to transaction.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">txn.commit(txnTimestamp);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>During processing, all transaction segments are merged into parent segments. This can happen for a batch of
transactions. As they are merged, the merge offsets are recorded by the controller and composed into a position object
for where the transaction write completed. Within a committed batch of transactions, writer-specific times are calculated
and reported. The watermarking workflow uses these reported times and positions in its next periodic cycle to compute
the watermark bounds.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="automatically-attach-wall-clock-time"></a>Automatically attach wall clock time<a class="hash-link" href="#automatically-attach-wall-clock-time" title="Direct link to heading">#</a></h3><p>You can set the <code>automaticallyNoteTime</code> option to true when a Writer is created. This option configures the Writer to
automatically attach a system time notation to every event. The option essentially attaches the ingest time to each
event. With this option turned on, no other calls to note the time are required.</p><p>Here is an example that configures automatic timestamps on events:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">EventStreamWriter&lt;EventType&gt; writer = clientFactory.createEventWriter(stream, serializer,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        EventWriterConfig.builder().automaticallyNoteTime(true).build());</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-pravega-readers-request-watermark-windows"></a>How Pravega Readers request watermark windows<a class="hash-link" href="#how-pravega-readers-request-watermark-windows" title="Direct link to heading">#</a></h2><p>Multiple Pravega Readers working in parallel each have different current locations in the stream. The Controller
coordinates the Reader positions and can return a window that indicates where in the stream all of the readers are.</p><p>The following Reader API method requests the current watermark window.</p><p><code>TimeWindow window = reader.getTimeWindow();</code></p><p>The <code>TimeWindow</code> is returned as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public class TimeWindow {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      private final long lowerTimeBound;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      private final long upperTimeBound;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>where:</p><ul><li><code>lowerTimeBound</code> of the  window is the watermark. The Controller asserts that all readers are done reading all events
earlier than the watermark.</li><li><code>upperTimeBound</code> is an arbitrary assignment that can help applications keep track of a moving window of time.</li></ul><p>The lower bound is most important as it corresponds to the low watermark. It takes into account the position of all
of the readers and represents the time before which all events have been read, under the assumption that ingestion
respected this order. Events of course can arrive out of order, in which case the low watermark becomes only a strong
indication that all the events with a lower timestamp have been read. When using this time window for window
aggregation, there is a point in which any given window needs to be declared closed, so that processing can occur. For
example, say that we want to count occurrences every hour. When the lower time bound advances to the hour, the
application may choose to immediately close the window and perform the count or wait longer. The choice is up to the
application.</p><p>If a reader asks for a time window from a stream whose writers are not generating time stamps, then `null is returned.</p><p>The TimeWindow reflects the current position in the stream. It can be called following every <code>readNextEvent()</code> call if
desired, or just periodically to provide support for grouping events into windows.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="preventing-a-stalled-watermark"></a>Preventing a stalled watermark<a class="hash-link" href="#preventing-a-stalled-watermark" title="Direct link to heading">#</a></h2><p>If a Pravega Writer goes down or is delayed and stops writing events, the Readers wait for possible delayed events from
that Writer. As a result, watermarks stop advancing.  While it is desirable for Readers to wait for delayed events, at
some point it makes sense to stop waiting. For example, perhaps the Writer is offline and is not coming back. The
controller must be allowed to emit a best attempt watermark so processing can continue.</p><p>To prevent Readers from waiting indefinitely for a Writer, you can configure the <code>timestampAggregationTimeout</code> parameter
on a stream. This parameter configures the amount of time after which a Writer that has not been heard from will be
excluded from the time window calculation.  Set this parameter on a stream when the stream is defined.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="integration-with-applications"></a>Integration with applications<a class="hash-link" href="#integration-with-applications" title="Direct link to heading">#</a></h2><p>Typically, an application running a Pravega reader interested in processing with time obtains the low watermark from
the time window. The application then needs downstream operators to process the watermark. For example, Apache Flink
is a stream processing engine that can propagate watermarks very well. We have a Pravega Flink connector that can get
a watermark from the Pravega Reader with the <code>AssignerWithTimeWindows</code> interface, which integrates the Pravega watermark
feature with the periodic watermark in Apache Flink. All Flink applications using Pravega can gain the benefits of event
time or ingest time watermarking using all the standard Apache Flink APIs.</p><p>Watermarking support in Pravega is useful in general in event time windowing applications. The following example
application gets a Pravega watermark and uses Apache Flink to process it. It reads data from Pravega and calculates an
average in every event-time 10 minutes. The watermark is important to provide the signal in real time to start and close
every 10-minute window.  The example is <a href="https://github.com/pravega/pravega-samples/blob/master/flink-connector-examples/src/main/java/io/pravega/example/flink/watermark/EventTimeAverage.java" target="_blank" rel="noopener noreferrer">here</a>.
A more in-depth description of the the example is <a href="https://github.com/pravega/pravega-samples/blob/master/flink-connector-examples/doc/watermark/README.md" target="_blank" rel="noopener noreferrer">here</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/claudiofahey/pravega/edit/docusaurus/documentation/src/docs/watermarking.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/docs/pravega/reader-group-design"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Reader Groups Design</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/docs/pravega/pravega-write-read-methods"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Methods for Writing and Reading Pravega Streams Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#concepts-related-to-watermarking" class="table-of-contents__link">Concepts related to watermarking</a><ul><li><a href="#the-watermark" class="table-of-contents__link">The watermark</a></li><li><a href="#time-window" class="table-of-contents__link">Time window</a></li><li><a href="#time" class="table-of-contents__link">Time</a></li></ul></li><li><a href="#how-pravega-writers-report-time" class="table-of-contents__link">How Pravega Writers report time</a><ul><li><a href="#explicitly-note-time" class="table-of-contents__link">Explicitly note time</a></li><li><a href="#note-time-on-transaction-commit" class="table-of-contents__link">Note time on transaction commit</a></li><li><a href="#automatically-attach-wall-clock-time" class="table-of-contents__link">Automatically attach wall clock time</a></li></ul></li><li><a href="#how-pravega-readers-request-watermark-windows" class="table-of-contents__link">How Pravega Readers request watermark windows</a></li><li><a href="#preventing-a-stalled-watermark" class="table-of-contents__link">Preventing a stalled watermark</a></li><li><a href="#integration-with-applications" class="table-of-contents__link">Integration with applications</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/sdp/overview">SDP Docs</a></li><li class="footer__item"><a href="https://www.dell.com/support/kbdoc/en-us/000124079/dell-emc-streaming-data-platform-infohub" target="_blank" rel="noopener noreferrer" class="footer__link-item">SDP InfoHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/blog">SDP Blog</a></li><li class="footer__item"><a href="https://blog.pravega.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pravega Blog</a></li><li class="footer__item"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pravega GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Dell</div></div></div></footer></div>
<script src="/docs/assets/js/styles.b1fb6875.js"></script>
<script src="/docs/assets/js/runtime~main.6fd86e16.js"></script>
<script src="/docs/assets/js/main.136b01c8.js"></script>
<script src="/docs/assets/js/1.3bcfe3f0.js"></script>
<script src="/docs/assets/js/2.9f9d1907.js"></script>
<script src="/docs/assets/js/83.e85de545.js"></script>
<script src="/docs/assets/js/84.8b65af75.js"></script>
<script src="/docs/assets/js/935f2afb.d24e4f9c.js"></script>
<script src="/docs/assets/js/17896441.654df565.js"></script>
<script src="/docs/assets/js/b253db87.77b98aad.js"></script>
</body>
</html>