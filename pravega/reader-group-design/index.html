<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.71">
<link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="Dell EMC Streaming Data Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="Dell EMC Streaming Data Platform Blog Atom Feed"><title data-react-helmet="true">Reader Groups Design | Dell EMC Streaming Data Platform</title><meta data-react-helmet="true" property="og:url" content="https://StreamingDataPlatform.github.io//docs/pravega/reader-group-design"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Reader Groups Design | Dell EMC Streaming Data Platform"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="shortcut icon" href="/docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://StreamingDataPlatform.github.io//docs/pravega/reader-group-design"><link data-react-helmet="true" rel="alternate" href="https://StreamingDataPlatform.github.io//docs/pravega/reader-group-design" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://StreamingDataPlatform.github.io//docs/pravega/reader-group-design" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.b0af8e75.css">
<link rel="preload" href="/docs/assets/js/styles.cd81ec63.js" as="script">
<link rel="preload" href="/docs/assets/js/runtime~main.e369d990.js" as="script">
<link rel="preload" href="/docs/assets/js/main.b22ffc5e.js" as="script">
<link rel="preload" href="/docs/assets/js/1.5eb17626.js" as="script">
<link rel="preload" href="/docs/assets/js/2.ad5efe07.js" as="script">
<link rel="preload" href="/docs/assets/js/76.03c2d757.js" as="script">
<link rel="preload" href="/docs/assets/js/935f2afb.f95ba67b.js" as="script">
<link rel="preload" href="/docs/assets/js/17896441.a677c3f2.js" as="script">
<link rel="preload" href="/docs/assets/js/c92f03bc.77506ad9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/">SDP Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs/"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">SDP Docs</a></li><li class="menu__list-item"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Streaming Data Platform</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/about">About</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Installation and Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/install/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/install/guide">Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/troubleshooting/index">Overview</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Developer&#x27;s Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/developer-guide/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/developer-guide/guide">Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Analytics</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Flink</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/analytics/flink/index">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Spark</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/analytics/spark/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/analytics/spark/deploying">Deploying</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/analytics/spark/troubleshooting">Troubleshooting</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Security Configuration Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/security-configuration/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/security-configuration/guide">Guide</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/index">Pravega Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Understanding Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/pravega-concepts">Pravega Concepts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/terminology">Terminology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/key-features">Pravega Key Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/faq">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/segment-store-service">Pravega Segment Store Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/segment-containers">Segment Containers in a Pravega Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/controller-service">Pravega Controller Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/wire-protocol">Pravega Streaming Service Wire Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/state-synchronizer-design">State Synchronizer Design</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/pravega/reader-group-design">Reader Groups Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/watermarking">Watermarking</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Developing Pravega Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/pravega-write-read-methods">Methods for Writing and Reading Pravega Streams</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/javadoc">Java API Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/rest/restapis">Pravega Controller APIs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/connectors">Pravega Connectors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/basic-reader-and-writer">Basic Reader and Writer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/state-synchronizer">State Synchronizer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/transactions">Transactions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/streamcuts">StreamCuts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Running Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/deployment">Pravega Deployment Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/manual-install">Manual Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/kubernetes-install">Deploying in Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/docker-swarm">Deploying in a Docker Swarm</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/dcos-install">Deploying on DC/OS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/aws-install">Running on AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/metrics">Pravega Metrics</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Pravega Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/auth/auth-plugin">Implementation of Pravega Authentication/Authorization Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/auth/client-auth">Client Auth Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/security/pravega-security-authorization-authentication">TLS, Authorization, Authentication - Enabling encryption, authorization and authentication features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/security/pravega-security-configurations">Pravega Security Configurations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/security/pravega-security-encryption">Pravega Encryption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/security/securing-distributed-mode-cluster">Setting Up Security for a Distributed Mode Cluster</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Contributing to Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/contributing">Contributing to Pravega</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/roadmap">Pravega Roadmap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/join-community">Join the Pravega Community</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Connectors</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Flink</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/quickstart">Quick Start</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/streaming">Streaming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/batch">Batch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/table-api">Table API</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/configurations">Configurations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/serialization">Serialization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Spark</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/samples">Samples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/build-connector">Building the Connector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/limitations">Limitations</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/pravega/nifi-pravega" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">NiFi</a></li><li class="menu__list-item"><a href="https://github.com/pravega?q=logstash" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Logstash</a></li><li class="menu__list-item"><a href="https://github.com/pravega/boomi-connector" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Boomi</a></li><li class="menu__list-item"><a href="https://github.com/pravega/kafka-adapter" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Kafka Adapter</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Reader Groups Design</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="motivation"></a>Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">#</a></h2><p>A set of Readers can be grouped together in order that the set of Events in a Stream can be read in parallel. This grouping of Readers is called a Reader Group. Pravega guarantees that each Event in the Stream is read by exactly one Reader in the Reader Group.</p><p>Each Reader in a Reader Group is assigned zero or more Stream Segments.
The Reader assigned to a Stream Segment is the only Reader within the Reader Group that reads Events from that Stream Segment. This is the fundamental mechanism by which Pravega makes ordering guarantees of Event delivery to a Reader â€“ a Reader will receive Events in the order they were written into a Stream Segment.
There are several challenges associated with this mechanism:</p><ul><li>How to maintain the mapping of which Reader within a Reader Group is assigned which Stream Segment?</li><li>How to manage the above mapping when Stream Segments split and merge?</li><li>How to manage the above mapping when Readers are added to the Reader Group?</li><li>How to manage the above mapping when Readers leave the Reader Group either by an explicit operation or the Reader becoming unavailable due to network outage or the Reader process failing?</li></ul><p>To address these challenges, we use <a href="/docs/pravega/state-synchronizer-design">State Synchronizer</a> to enable coordination among Readers.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="consistent-replicated-state"></a>Consistent Replicated State<a class="hash-link" href="#consistent-replicated-state" title="Direct link to heading">#</a></h3><p>A consistent replicated state object representing the Reader Group metadata will be created in each Reader. This Reader Group metadata consists of:</p><ul><li>A map of online Readers to the Stream Segments they own.</li><li>A list of positions in Stream Segments that can be taken over.</li></ul><p>Every time the Readers in a Reader Group change, the state can be updated. The replicated state is updated every time a Reader starts reading a new Stream Segment. Thus every Reader is aware of the Stream Segments owned by all the Readers in the their Reader Group.</p><p>Given this information:</p><ul><li>A new Reader can infer which Stream Segments are available to read from. (By virtue of it being absent from the state).</li><li>Dealing with a Stream Segment being merged becomes easy, because the last reader to reach the end of its pre-merge Stream Segment knows it can freely take ownership of the new Stream Segment.</li><li>Readers can see their relative load and how they are progressing relative to the other Readers in their group and can decide to transfer Stream Segments if things are out of balance.</li><li>This allows Readers to take action directly to ensure all the events are read without the need for some external tracker.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reader-group-apis"></a>Reader Group APIs<a class="hash-link" href="#reader-group-apis" title="Direct link to heading">#</a></h2><p>The external APIs to manage Reader Groups could be added to the <code>ReaderGroupManager</code> object. It consist of:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ReaderGroup createReaderGroup(String name, Stream stream, ReaderGroupConfig config);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ReaderGroup getReaderGroup(String name, Stream stream);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    void deleteReaderGroup(ReaderGroup group);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>When a Reader Group is created, it creates a <a href="/docs/pravega/state-synchronizer-design">State Synchronizer</a> shared by the Readers. To join a Reader Group, Readers would just specify it in their configuration:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ClientFactory clientFactory = ClientFactory.withScope(scope, controllerURI);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EventStreamReader&lt; T &gt; reader = clientFactory.createReader(readerId, READER_GROUP_NAME, serializer, readerConfig);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The Readers, while joining the group, access the information stored on the state to determine which Stream Segments to read from. Once when they shut down, they update the state so that other Readers can take over their Stream Segments.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="detecting-pravega-reader-failure"></a>Detecting Pravega Reader Failure<a class="hash-link" href="#detecting-pravega-reader-failure" title="Direct link to heading">#</a></h1><p>We still need some effective mechanism to identify, whether Readers are alive or not. The problem is greatly simplified because it need not produce a view of the cluster or manage any state. The component would just need to detect a Reader failure and invoke the <code>void ReaderOffline(String ReaderId, Position lastPosition);</code> API on the Reader Group.</p><p>For consistency, the &quot;Failure detector&quot; should not declare a host as dead that is still processing events. Doing so could violate exactly once processing guarantees.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="new-reader-added"></a>New Reader Added<a class="hash-link" href="#new-reader-added" title="Direct link to heading">#</a></h2><ol><li>When a Reader joins a group its online status is added to the shared state.</li><li>Other Readers receive updates to the shared state.</li><li>When a Reader with more than average number of Stream Segments sees the new Reader, it may give up a Stream Segment by writing its position for that Stream Segment to the shared state.</li><li>The new Reader can take over a Stream Segment by recording that it is doing so in the shared state.</li><li>The new Reader can start reading from the position it read from the shared state for the Stream Segment it picked up.</li></ol><p>There are no races between multiple Readers coming online concurrently because only one of them can successfully claim ownership of any given Stream Segment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="stream-segments-get-merged"></a>Stream Segments Get Merged<a class="hash-link" href="#stream-segments-get-merged" title="Direct link to heading">#</a></h2><ol><li>When a Reader comes to the end of its Stream Segment it records this information in the shared state.</li><li>When all of the Stream Segments that are getting merged together are completed, a Reader may claim ownership of the following Stream Segment.</li></ol><p>There is no ambiguity as to who the owner is, because it is stored in the shared state. There is no risk of a Stream Segment being ignored because every Reader can see the available Stream Segments by looking at the shared state and claim them.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reader-offline"></a>Reader Offline<a class="hash-link" href="#reader-offline" title="Direct link to heading">#</a></h2><ol><li><p>When a Reader dies, the <code>void ReaderOffline(String ReaderId, Position lastPosition);</code> API method will be invoked either by the Reader itself in a graceful shutdown (internally to the close method) or via a &quot;liveness detector&quot;. In either case the Reader&#x27;s last position is written to the state.</p></li><li><p>If a null <code>Position</code> is sent then the last checkpointed position will be written to the state.</p></li><li><p>This is used by the newer Readers when they take ownership of the Stream Segment(s) that were read by the older/offline reader.</p></li><li><p>Any Reader can decide to take over one or more of the Stream Segments owned by the old Reader from where it left off by recording their intention to do so in the state object.</p></li><li><p>Once the state has been updated by the new Reader, it is considered the owner of the Stream Segment and can read from it.</p></li></ol><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="other-considerations-on-reader-groups"></a>Other Considerations on Reader Groups<a class="hash-link" href="#other-considerations-on-reader-groups" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-happens-if-a-reader-does-not-keep-up-to-date"></a>What happens if a Reader does not keep up to date?<a class="hash-link" href="#what-happens-if-a-reader-does-not-keep-up-to-date" title="Direct link to heading">#</a></h2><p>A Reader with out-of-date state can read from their existing Stream Segments without interference. The only disadvantage to this is that they will not shed load to another Reader should one become available. However, because they have to write to the shared state to start reading from any Stream Segment which they don&#x27;t already own, they must fetch up-to-date information before moving on to a new Stream Segment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="impact-of-availability-and-latency"></a>Impact of availability and latency<a class="hash-link" href="#impact-of-availability-and-latency" title="Direct link to heading">#</a></h2><p>Reading and updating the state object can occur in parallel to reading, so there would likely be no visible latency impact.
A stream would be unavailable for reading if Pravega failed in such a way that the Stream Segment containing the Reader Group information went down and remained offline for long enough for the Readers to exhaust all the events in their existing Stream Segments. Of course, if Pravega failed in this way, odds are at least some portion of the stream would also be directly impacted and not be able to read any events. This sort of failure mode would manifest as latency for the Reader, similar to what would happen if they had reached the tail of the stream.</p><p>This is preferable to using an external system to manage this coordination, as that would require adding new components that can fail in different ways, as opposed to further relying on a small set that we need to make highly available anyway. This is particularly notable in the case of a network partition. If the network is split any Readers that are on the same side of the partition as the Pravega servers can continue working. If we were to utilize an external service, that service could be cut off and Readers might not be able to make progress even if they could talk to Pravega.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/claudiofahey/pravega/edit/docusaurus/documentation/src/docs/reader-group-design.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/pravega/state-synchronizer-design"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« State Synchronizer Design</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/pravega/watermarking"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Watermarking Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link">Motivation</a><ul><li><a href="#consistent-replicated-state" class="table-of-contents__link">Consistent Replicated State</a></li></ul></li><li><a href="#reader-group-apis" class="table-of-contents__link">Reader Group APIs</a></li><li><a href="#new-reader-added" class="table-of-contents__link">New Reader Added</a></li><li><a href="#stream-segments-get-merged" class="table-of-contents__link">Stream Segments Get Merged</a></li><li><a href="#reader-offline" class="table-of-contents__link">Reader Offline</a></li><li><a href="#what-happens-if-a-reader-does-not-keep-up-to-date" class="table-of-contents__link">What happens if a Reader does not keep up to date?</a></li><li><a href="#impact-of-availability-and-latency" class="table-of-contents__link">Impact of availability and latency</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">SDP Overview</a></li><li class="footer__item"><a href="https://www.dell.com/support/kbdoc/en-us/000124079/dell-emc-streaming-data-platform-infohub" target="_blank" rel="noopener noreferrer" class="footer__link-item">SDP InfoHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.pravega.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Dell</div></div></div></footer></div>
<script src="/docs/assets/js/styles.cd81ec63.js"></script>
<script src="/docs/assets/js/runtime~main.e369d990.js"></script>
<script src="/docs/assets/js/main.b22ffc5e.js"></script>
<script src="/docs/assets/js/1.5eb17626.js"></script>
<script src="/docs/assets/js/2.ad5efe07.js"></script>
<script src="/docs/assets/js/76.03c2d757.js"></script>
<script src="/docs/assets/js/935f2afb.f95ba67b.js"></script>
<script src="/docs/assets/js/17896441.a677c3f2.js"></script>
<script src="/docs/assets/js/c92f03bc.77506ad9.js"></script>
</body>
</html>