<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.71">
<link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="Dell EMC Streaming Data Platform Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="Dell EMC Streaming Data Platform Blog Atom Feed"><title data-react-helmet="true">State Synchronizer | Dell EMC Streaming Data Platform</title><meta data-react-helmet="true" property="og:url" content="https://StreamingDataPlatform.github.io//docs/pravega/state-synchronizer"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="State Synchronizer | Dell EMC Streaming Data Platform"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="shortcut icon" href="/docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://StreamingDataPlatform.github.io//docs/pravega/state-synchronizer"><link data-react-helmet="true" rel="alternate" href="https://StreamingDataPlatform.github.io//docs/pravega/state-synchronizer" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://StreamingDataPlatform.github.io//docs/pravega/state-synchronizer" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.b0af8e75.css">
<link rel="preload" href="/docs/assets/js/styles.cd81ec63.js" as="script">
<link rel="preload" href="/docs/assets/js/runtime~main.e369d990.js" as="script">
<link rel="preload" href="/docs/assets/js/main.b22ffc5e.js" as="script">
<link rel="preload" href="/docs/assets/js/1.5eb17626.js" as="script">
<link rel="preload" href="/docs/assets/js/2.ad5efe07.js" as="script">
<link rel="preload" href="/docs/assets/js/76.03c2d757.js" as="script">
<link rel="preload" href="/docs/assets/js/935f2afb.f95ba67b.js" as="script">
<link rel="preload" href="/docs/assets/js/17896441.a677c3f2.js" as="script">
<link rel="preload" href="/docs/assets/js/fbeedf11.5c08ac5b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/">SDP Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs/"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs/img/logo.svg" alt="Dell Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">SDP Docs</a></li><li class="menu__list-item"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Streaming Data Platform</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/about">About</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Installation and Administration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/install/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/install/guide">Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/troubleshooting/index">Overview</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Developer&#x27;s Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/developer-guide/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/developer-guide/guide">Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Analytics</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Flink</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/analytics/flink/index">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Spark</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/analytics/spark/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/analytics/spark/deploying">Deploying</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/analytics/spark/troubleshooting">Troubleshooting</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Security Configuration Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/security-configuration/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sdp/security-configuration/guide">Guide</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/index">Pravega Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/getting-started">Getting Started</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Understanding Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/pravega-concepts">Pravega Concepts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/terminology">Terminology</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/key-features">Pravega Key Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/faq">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/segment-store-service">Pravega Segment Store Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/segment-containers">Segment Containers in a Pravega Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/controller-service">Pravega Controller Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/wire-protocol">Pravega Streaming Service Wire Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/state-synchronizer-design">State Synchronizer Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/reader-group-design">Reader Groups Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/watermarking">Watermarking</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Developing Pravega Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/pravega-write-read-methods">Methods for Writing and Reading Pravega Streams</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/javadoc">Java API Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/rest/restapis">Pravega Controller APIs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/connectors">Pravega Connectors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/basic-reader-and-writer">Basic Reader and Writer</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/pravega/state-synchronizer">State Synchronizer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/transactions">Transactions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pravega/streamcuts">StreamCuts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Running Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/deployment">Pravega Deployment Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/manual-install">Manual Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/kubernetes-install">Deploying in Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/docker-swarm">Deploying in a Docker Swarm</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/dcos-install">Deploying on DC/OS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/deployment/aws-install">Running on AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/metrics">Pravega Metrics</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Pravega Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/auth/auth-plugin">Implementation of Pravega Authentication/Authorization Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/auth/client-auth">Client Auth Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/security/pravega-security-authorization-authentication">TLS, Authorization, Authentication - Enabling encryption, authorization and authentication features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/security/pravega-security-configurations">Pravega Security Configurations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/security/pravega-security-encryption">Pravega Encryption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/security/securing-distributed-mode-cluster">Setting Up Security for a Distributed Mode Cluster</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Contributing to Pravega</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/contributing">Contributing to Pravega</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/roadmap">Pravega Roadmap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/pravega/join-community">Join the Pravega Community</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Connectors</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Flink</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/quickstart">Quick Start</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/streaming">Streaming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/batch">Batch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/table-api">Table API</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/configurations">Configurations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/flink-connectors/serialization">Serialization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Spark</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/index">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/samples">Samples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/build-connector">Building the Connector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/spark-connectors/limitations">Limitations</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/pravega/nifi-pravega" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">NiFi</a></li><li class="menu__list-item"><a href="https://github.com/pravega?q=logstash" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Logstash</a></li><li class="menu__list-item"><a href="https://github.com/pravega/boomi-connector" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Boomi</a></li><li class="menu__list-item"><a href="https://github.com/pravega/kafka-adapter" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Kafka Adapter</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">State Synchronizer</h1></header><div class="markdown"><p>You can think about Pravega as a streaming storage primitive, because it is a
great way to durably persist data. Â You can think about Pravega as a great
pub-sub messaging system, because with Readers, Writers and ReaderGroups it is a
great way to do messaging at scale. Â But you can also think about Pravega as a
way to implement shared state in a consistent fashion across multiple
cooperating processes distributed in a cluster. Â It is this latter category that
we explore with this document.</p><p>Instructions for running the sample applications can be found in the<a href="https://github.com/pravega/pravega-samples/blob/v0.5.0/pravega-client-examples/README.md" target="_blank" rel="noopener noreferrer">Â Pravega
Samples
readme</a>.</p><p>You really should be familiar with Pravega Concepts (seeÂ <a href="/docs/pravega/pravega-concepts">Pravega
Concepts</a>) before continuing reading this page.
Â In particular, you should be somewhat familiar with the <a href="/docs/pravega/pravega-concepts#state-synchronizers">State
Synchronizer</a>
concept.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="shared-state-and-pravega"></a>Shared State and Pravega<a class="hash-link" href="#shared-state-and-pravega" title="Direct link to heading">#</a></h2><p>State Synchronizer is a facility provided by the Pravega programming model to
make it easy for developers to use Pravega to coordinate shared state between
processes.</p><p><img alt="state synchronizer" src="/docs/assets/images/state.synchronizer-19251aa5a0a3fa4cfcc13fd91de8ccb9.png"></p><p>The idea is that a Stream is used to persist a sequence of changes to shared
state and that various applications use their Pravega Java Client Library to
concurrently read and write the shared state in a consistent fashion.Â </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sharedstatemap-and-shared-configuration-example"></a>SharedStateMap and Shared Configuration Example<a class="hash-link" href="#sharedstatemap-and-shared-configuration-example" title="Direct link to heading">#</a></h2><p>Before we dive into the details about how to use State Synchronizer, let&#x27;s take
a quick look at an example application that uses State Synchronizer. Â We have
provided a simple yet illustrative example of using State
SynchronizerÂ <a href="https://github.com/pravega/pravega-samples/tree/v0.5.0/pravega-client-examples/src/main/java/io/pravega/example/statesynchronizer" target="_blank" rel="noopener noreferrer">here.</a></p><p>The example uses State Synchronizer to build an implementation of Java&#x27;s Map
data structure called SharedMap. Â We use that primitive SharedMap data structure
to build a Shared Config, that allows a set of processes to consistently
read/write a shared, configuration object of key/value pair properties. Â Also as
part of that example, we provide a simple command line-based application that
allows you to play around with the SharedConfig app.</p><p><img alt="state synchronizer example" src="/docs/assets/images/state.sync.example-9cbe4d85fe30e0997f333dc01d84cf10.png"></p><p>Here is a menu of the available commands in the SharedConfigCLI application:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter one of the following commands at the command line prompt:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">GET_ALL - prints out all of the properties in the Shared Config.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">GET {key} - print out the configuration property for the given key.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PUT {key} , {value} - update the Shared Config with the given key/value pair.  Print out previous value (if it existed).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PUT_IF_ABSENT {key} , {value} - update the Shared Config with the given key/value pair, only if the property is not already defined.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">REMOVE {key} [ , {currentValue}] - remove the given property from the Shared Config.  If {currentValue} is given, remove only if the property&#x27;s current value matches {currentValue}..</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">REPLACE {key} , {newValue} [ , {currentValue}] - update the value of the property.  If {currentValue} is given, update only if the property&#x27;s current value matches {cuurentValue}.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CLEAR - remove all the keys from the Shared Config.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">REFRESH - force an update from the Synchronized State.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">HELP - print out a list of commands.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">QUIT - terminate the program.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Install the Pravega-Samples and launch two instances of the SharedConfigCLI
using the same scope and stream name. Â This will simulate how two different
processes can coordinate their local copy of the SharedConfig with one shared
state object. Â You can follow these steps to get a feel for how the SharedConfig
is coordinated:</p><table><thead><tr><th><strong>#</strong></th><th><strong>Process 1</strong></th><th><strong>Process 2</strong></th><th><strong>Discussion</strong></th></tr></thead><tbody><tr><td>1</td><td><strong>GET_ALL</strong></td><td><strong>GET_ALL</strong></td><td>Shows that both processes see an empty SharedConfig</td></tr><tr><td>2</td><td><strong>PUT</strong> p1,v1</td><td></td><td>Process 1 adds a property named p1</td></tr><tr><td>3</td><td><strong>GET</strong> p1</td><td><strong>GET</strong> p1</td><td>Process 1 sees value v1 for the property</td></tr><tr><td></td><td></td><td></td><td>Process 2 does not have a property named p1. Why? Because it has not refreshed its state with the shared state</td></tr><tr><td>4</td><td></td><td><strong>REFRESH</strong></td><td>Re-synchronize Process 2&#x27;s state with the shared state</td></tr><tr><td>5</td><td></td><td><strong>GET</strong> p1</td><td>Now Process 2 sees the change Process 1 made in step 2</td></tr><tr><td>6</td><td></td><td><strong>REPLACE</strong> p1, newVal, v1</td><td>Process 2 attempts to change the value of p1, but uses a conditional replace, meaning the change should be made only if the old value of p1 is v1 (which it is at this point)</td></tr><tr><td>7</td><td></td><td><strong>GET</strong> p1</td><td>Sure enough, the value of p1 was changed to newVal</td></tr><tr><td>8</td><td><strong>REPLACE</strong> p1, anotherVal, v1</td><td></td><td>Process 1 tries to change the value of p1 in the same way Process 2 did in step 6. This will fail because the value of p1 in shared state is no longer v1</td></tr><tr><td>9</td><td><strong>GET</strong> p1</td><td></td><td>The failed replace operation in step 8 caused Process 1&#x27;s copy of the shared state to be updated, its value is now newVal because of step 6.</td></tr></tbody></table><p>You can repeat with a similar sequence to explore the semantics of
PUT_IF_ABSENT and other operations that modify shared state.</p><p>The idea is that modifications to the SharedConfig succeed only if they operate
on the latest value. Â We use optimistic concurrency to implement efficient
consistency across multiple consumers of the SharedConfig object.</p><p>You can have multiple different SharedConfig state objects running
simultaneously, each separate SharedConfig uses State Synchronizer objects based
on a different Pravega Stream. Â Of course if you launch two applications using
State Synchronizer objects backed by the same Stream, you get two processes
concurrently accessing the shared state. Â This is exactly the situation we
illustrated above.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-state-synchronizer-to-build-the-sharedmap"></a>Using State Synchronizer to Build the SharedMap<a class="hash-link" href="#using-state-synchronizer-to-build-the-sharedmap" title="Direct link to heading">#</a></h2><p>We used the State Synchronizer to build the SharedMap object in Pravega-Samples.
Â State Synchronizer can be used to build a shared version of almost any data
structure. Â Maybe your app needs to share just a simple integer count of
something; we can use State Synchronizer to build a simple shared counter.
Â Maybe the data you are sharing is a Set of currently running servers in a
cluster; Â we can use State Synchronizer to build Â a shared Set. Â The
possibilities are many.</p><p>Let&#x27;s explore how to build shared objects using State Synchronizer by examining
how we built Shared Map.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="state-synchronizer"></a>State Synchronizer<a class="hash-link" href="#state-synchronizer" title="Direct link to heading">#</a></h3><p>State Synchronizer is a type of Pravega client, similar to an EventStreamReader
or EventStreamWriter. Â A State Synchronizer is created via a ClientFactory
object. Â Each State Synchronizer has a unique name within a Scope. Â A
SynchronizerConfig object is used to tailor the behavior of a StateSynchronizer
(although currently, there are no properties on a State Synchronizer that are
configurable). Â State Synchronizer uses Java generic types to allow a developer
to specify a type specific State Synchronizer. Â All of these things are done in
a fashion similar to how EventStreamReaders and EventStreamWriters are used.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="statet"></a>StateT<a class="hash-link" href="#statet" title="Direct link to heading">#</a></h3><p>When designing an application that uses State Synchronizer, the developer needs
to decide what type of state is going to be synchronized (shared). Â Are we
sharing a Map? Â A Set? Â A Pojo? What is the data structure that is being shared.
Â This defines the core &quot;type&quot; of the State Synchronizer (the StateT generic type
in the State Synchronizer interface). Â The StateT object can be any Java object
that implements the <em>Revisioned</em> interface defined by Pravega. Â <em>Revisioned</em> is
a simple interface that allows Pravega to ensure it can properly compare two
different StateT objects.</p><p>In our example, the SharedMap is the State Synchronizer application. Â It defines
a simple Map object presenting the typical get(key), set (key, value) etc.
operations you would expect from a key-value pair map object. Â It
implementsÂ Â theÂ <em>Revisioned</em>Â interface, as required to use the State
Synchronizer, and uses a simple ConcurrentHashMap as its internal implementation
of the Map. Â So in our example, StateT corresponds to SharedStateMap\&lt;K,V&gt;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="updatet-and-initialupdatet"></a>UpdateT and InitialUpdateT<a class="hash-link" href="#updatet-and-initialupdatet" title="Direct link to heading">#</a></h3><p>In addition to StateT, there are two other generic types that need to be defined
by a StateSynchronizer app: an Update type and an InitialUpdate type). Â The
UpdateType represents the &quot;delta&quot; or change objects that are persisted on the
Pravega Stream. Â The InitialUpdateType is a special update object used to to
start the State Synchronizer off. Â Both UpdateType and InitialUpdateType are
defined in terms of StateT.</p><p>The StateSynchronizer uses a single Segment on a Stream to store updates
(changes) to the shared state object. Â Changes, in the form of Initial or Update
type objects, are written to the Stream based on whether the update is relative
to the most current copy of the state in the Stream. Â If an update is presented
that is based on an older version of the state, the update is not made.</p><p>The StateSynchronizer object itself keeps a local in memory copy of the state,
it also keeps version metadata about that copy of the state. Â Local state can be
retrieved using the getState() operation. Â The local in memory copy could be
stale, and it can be refreshed by an application using the fetchUpdates()
operation, that retrieves all the changes made to the given version of the
state.</p><p>Most changes from the application are made through the updateState() operation.
Â The updateState() operation takes a Function as parameter. Â The Function is
invoked with the latest state object, and computes the updates to be applied.</p><p>In our example, InitialUpdateT is implemented as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Create a Map. This is used by StateSynchronizer to initialize shared state.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">private static class CreateState&lt;K, V&gt; implements InitialUpdate&lt;SharedStateMap&lt;K,V&gt;&gt;, Serializable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final long serialVersionUID = 1L;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private final ConcurrentHashMap&lt;K, V&gt; impl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public CreateState(ConcurrentHashMap&lt;K, V&gt; impl) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        this.impl = impl;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public SharedStateMap&lt;K, V&gt; create(String scopedStreamName, Revision revision) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new SharedStateMap&lt;K, V&gt;(scopedStreamName, impl, revision);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In this case, the CreateState class is used to initialize the shared state in
the Stream by creating a new, empty SharedStateMap object. Â You could imagine
other examples of InitialUpdate that would set a counter to 1, or perhaps
initialize a Set to a fixed initial set of members.</p><p>It may seem a bit odd that functions like &quot;initialize&quot; and &quot;update&quot; are
expressed as classes, but when you think about it, that makes sense. Â The
changes, like initialize and update, need to be stored in Pravega, therefore
they need to be serializable objects. Â It must be possible for client
applications to be able to start at any time, compute the current state and then
keep up as changes are written to the Stream. Â If we just stored &quot;the latest
state value&quot; in the Stream, there would be no way to consistently provide
concurrent update and read using optimistic concurrency.</p><p>UpdateT is a bit more tricky. Â There isn&#x27;t just one kind of update to a Map, but
rather there are all sorts of updates: put of a key/value pair, put of a
collection of key/value pairs, removing a key/value pair and clearing all of the
key/value pairs, Â Each of these &quot;kinds&quot; of updates are represented by their own
Class. Â We define an abstract class, called StateUpdate, from which all of these
&quot;operational&quot; update classes inherit. Â </p><p><strong>StateUpdate abstract class</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * A base class for all updates to the shared state. This allows for several different types of updates.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">private static abstract class StateUpdate&lt;K,V&gt; implements Update&lt;SharedStateMap&lt;K,V&gt;&gt;, Serializable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final long serialVersionUID = 1L;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public SharedStateMap&lt;K,V&gt; applyTo(SharedStateMap&lt;K,V&gt; oldState, Revision newRevision) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ConcurrentHashMap&lt;K, V&gt; newState = new ConcurrentHashMap&lt;K, V&gt;(oldState.impl);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        process(newState);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new SharedStateMap&lt;K,V&gt;(oldState.getScopedStreamName(), newState, newRevision);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public abstract void process(ConcurrentHashMap&lt;K, V&gt; updatableList);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>By defining an abstract class, we can define UpdateT in terms of the abstract
StateUpdate class. Â The abstract class implements the &quot;applyTo&quot; method that is
invoked by the StateSynchronizer to apply the update to the current state object
and return an updated state object. Â The actual work is done on a copy of the
old state&#x27;s underlying Map (impl) object, a &quot;process&quot; operation is applied
(specific to each subclass) to the impl object and a new version of the
SharedState, using the post-processed impl as the internal state. Â The abstract
class defines a process() method that actually does the work of whatever update
needs to be applied. Â This method is implemented by the various concrete classes
that represent Put, PutAll etc. operations on the shared map.</p><p>Here, for example, is the way we implement the Put(key,value) operation on the
SharedMap object:</p><p><strong>Put as an Update Object</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Add a key/value pair to the State.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">private static class Put&lt;K,V&gt; extends StateUpdate&lt;K,V&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final long serialVersionUID = 1L;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private final K key;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private final V value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public Put(K key, V value) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        this.key = key;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        this.value = value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public void process(ConcurrentHashMap&lt;K, V&gt; impl) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        impl.put(key, value);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Here, the process() operation is to add a key/value pair to the map, or if the
key already exists, change the value. Â Each of the &quot;operations&quot; on the SharedMap
is implemented in terms of creating instances of the various subclasses of
StateUpdate.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="executing-operations-on-sharedmap"></a>Executing Operations on SharedMap<a class="hash-link" href="#executing-operations-on-sharedmap" title="Direct link to heading">#</a></h2><p>SharedMap demonstrates the typical operations on a StateSynchronizer. Â SharedMap
presents an API, very similar to Java&#x27;s Map\&lt;K,V&gt; interface. Â It implements the
Map operations in terms of manipulating the StateSynchronizer, using the various
subclasses of StateUpdate to perform state change (write) operations.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="createinitialize"></a>Create/InitializeÂ <a class="hash-link" href="#createinitialize" title="Direct link to heading">#</a></h3><p><strong>Creating a SharedMap</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * Creates the shared state using a synchronizer based on the given stream name.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param clientFactory - the Pravega ClientFactory to use to create the StateSynchronizer.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param streamManager - the Pravega StreamManager to use to create the Scope and the Stream used by the StateSynchronizer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param scope - the Scope to use to create the Stream used by the StateSynchronizer.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param name - the name of the Stream to be used by the StateSynchronizer.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public SharedMap(ClientFactory clientFactory, StreamManager streamManager, String scope, String name){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     streamManager.createScope(scope);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     StreamConfiguration streamConfig = StreamConfiguration.builder().scope(scope).streamName(name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             .scalingPolicy(ScalingPolicy.fixed(1))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             .build();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     streamManager.createStream(scope, name, streamConfig);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     this.stateSynchronizer = clientFactory.createStateSynchronizer(name,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                             new JavaSerializer&lt;StateUpdate&lt;K,V&gt;&gt;(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                             new JavaSerializer&lt;CreateState&lt;K,V&gt;&gt;(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                             SynchronizerConfig.builder().build());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     stateSynchronizer.initialize(new CreateState&lt;K,V&gt;(new ConcurrentHashMap&lt;K,V&gt;()));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>A SharedMap object is created by defining the scope and stream (almost always
the case, the scope and stream probably already exist, so the steps in lines
10-16 are usually no-ops. Â The StateSynchronizer object itself is constructed in
lines 18-21 using the ClientFactory in a fashion similar to the way a Pravega
Reader or Writer would be created. Â Note that the UpdateT object and
InitialUpdateT object can have separate Java serializers specified. Â Currently,
the SynchronizerConfig object is pretty dull; there are no configuration items
currently available on the StateSynchronizer.</p><p>The StateSynchronizer provides an initialize() API that takes an InitialUpdate
object. Â This is called in the SharedMap constructor to make sure the
SharedState is properly initialized. Â Note, in many cases, the SharedMap object
will be created on a stream that already contains shared state for the
SharedMap. Â Even in this case, it is ok to call initialize() because
initialize() won&#x27;t modify the shared state in the Stream.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="read-operations"></a>Read Operations<a class="hash-link" href="#read-operations" title="Direct link to heading">#</a></h3><p>The read operations, operations that do not alter shared state, like get(key)
Â containsValue(value) etc., work against the local copy of the
StateSynchronizer. Â All of these operations retrieve the current local state
using getState() and then do the read operation from that state. Â The local
state of the StateSynchronizer might be stale. Â In these cases, the SharedMap
client would use refresh() to force the StateSynchronizer to refresh its state
from shared state using the fetchUpdates() operation on the StateSynchronizer
object.</p><p>Note, this is a design decision to trade off staleness for responsiveness. Â We
could easily have implemented the read operations to instead always do a refresh
before doing the read against local state. Â That would be a very efficient
strategy if the developer expected that there will be frequent updates to the
shared state. Â In our case, we had imagined that the SharedMap would be read
frequently but updated relatively infrequently, and therefore chose to read
against local state.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="write-update-operations"></a>Write (update) Operations<a class="hash-link" href="#write-update-operations" title="Direct link to heading">#</a></h3><p>Each write operation is implemented in terms of the various concrete StateUpdate
objects we discussed earlier. Â The clear() operation uses the Clear subclass of
StateUpdate to remove all the key/value pairs, put() uses the Put class, etc.</p><p>Lets dive into the implementation of the put() operation to discuss
StateSynchronizer programming in a bit more detail:</p><p><strong>Implementing put(key,value)</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * Associates the specified value with the specified key in this map.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @param key - the key at which the value should be found.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @param value - the value to be entered into the map.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @return - the previous value (if it existed) for the given key or null if the key did not exist before this operation.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public V put(K key, V value){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    final AtomicReference&lt;V&gt; oldValue = new AtomicReference&lt;V&gt;(null);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     stateSynchronizer.updateState((state, updates) -&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        oldValue.set(state.get(key));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        updates.add(new Put&lt;K,V&gt;(key,value));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return oldValue.get();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It is important to note that the function provided to the StateSynchronizer&#x27;s
updateState() will be called potentially multiple times. The result of applying the function to the old state is written
only when it is applied against the most current revision of the state.
If there was a race and the optimistic concurrency check fails, it will be called again.
Most of the time there will only be a small number of invocations. Â In some cases, the
developer may choose to use fetchUpdates() to synchronize the StateSynchronizer
with the latest copy of shared state from the stream before running
updateState(). Â This is a matter of optimizing the tradeoff between how frequent
updates are expected and how efficient you want the update to be. Â If you expect
a lot of updates, call fetchUpdates() before calling updateState(). Â In our
case, we didn&#x27;t expect a lot of updates and therefore we process potentially
several invocations of the function each time put() is called.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="delete-operations"></a>Delete Operations<a class="hash-link" href="#delete-operations" title="Direct link to heading">#</a></h3><p>We chose to implement the delete (remove) operations to also leverage the
compact() feature of StateSynchronizer. Â We have a policy that after every 5
remove operations, and after every clear() operation, we do a compact operation.
Â Now, we could have chosen to do a compact() operation after every 5 update
operations, but we wanted to isolate the illustration of using compact() to just
delete operations.</p><p>You can think of compact() as a form of &quot;garbage collection&quot; in
StateSynchronizer. Â After a certain number of changes have been written to
SharedState, it might be efficient to write out a new initial state, an
accumulated representation of all the changes, to the Stream. Â That way data
older than the compact operation can be ignored and eventually removed from the
Stream.</p><p><img alt="state synchronizer compact" src="/docs/assets/images/ss.compact-87012c2cb2a5df4fbf0f7be3ce1bfb81.png"></p><p>As a result of the compact() operation, a new initial sate (Initial2) is written
to the stream. Â Now, all the data from Change3 and older is no longer relevant
and can be garbage collected out of the Stream.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/claudiofahey/pravega/edit/docusaurus/documentation/src/docs/state-synchronizer.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/pravega/basic-reader-and-writer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Basic Reader and Writer</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/pravega/transactions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transactions Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#shared-state-and-pravega" class="table-of-contents__link">Shared State and Pravega</a></li><li><a href="#sharedstatemap-and-shared-configuration-example" class="table-of-contents__link">SharedStateMap and Shared Configuration Example</a></li><li><a href="#using-state-synchronizer-to-build-the-sharedmap" class="table-of-contents__link">Using State Synchronizer to Build the SharedMap</a><ul><li><a href="#state-synchronizer" class="table-of-contents__link">State Synchronizer</a></li><li><a href="#statet" class="table-of-contents__link">StateT</a></li><li><a href="#updatet-and-initialupdatet" class="table-of-contents__link">UpdateT and InitialUpdateT</a></li></ul></li><li><a href="#executing-operations-on-sharedmap" class="table-of-contents__link">Executing Operations on SharedMap</a><ul><li><a href="#createinitialize" class="table-of-contents__link">Create/InitializeÂ </a></li><li><a href="#read-operations" class="table-of-contents__link">Read Operations</a></li><li><a href="#write-update-operations" class="table-of-contents__link">Write (update) Operations</a></li><li><a href="#delete-operations" class="table-of-contents__link">Delete Operations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">SDP Overview</a></li><li class="footer__item"><a href="https://www.dell.com/support/kbdoc/en-us/000124079/dell-emc-streaming-data-platform-infohub" target="_blank" rel="noopener noreferrer" class="footer__link-item">SDP InfoHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.pravega.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/pravega/pravega" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Dell</div></div></div></footer></div>
<script src="/docs/assets/js/styles.cd81ec63.js"></script>
<script src="/docs/assets/js/runtime~main.e369d990.js"></script>
<script src="/docs/assets/js/main.b22ffc5e.js"></script>
<script src="/docs/assets/js/1.5eb17626.js"></script>
<script src="/docs/assets/js/2.ad5efe07.js"></script>
<script src="/docs/assets/js/76.03c2d757.js"></script>
<script src="/docs/assets/js/935f2afb.f95ba67b.js"></script>
<script src="/docs/assets/js/17896441.a677c3f2.js"></script>
<script src="/docs/assets/js/fbeedf11.5c08ac5b.js"></script>
</body>
</html>